<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>අධ්‍යන ප්‍රගති සංවර්ධන වැඩසටහන</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pdftron/webviewer@10.6.0/webviewer.min.js"></script>
    <link rel="stylesheet" href="index.css">
    <link rel="icon" href="Resources/paper.ico" type="image/x-icon">
    <link rel="shortcut icon" href="Resources/paper.ico" type="image/x-icon">
</head>

<style>
    html,
    body {
        height: -webkit-fill-available;
        width: -webkit-fill-available;
        background-color: #f3f4f6;
        font-family: "unMalithi", sans-serif;
        font-size: larger;
        line-height: unset !important;
        font-size: 1.2em;
        font-weight: 600;
    }

    .cover {
        width: 90%;
        height: 90%;
        background-color: #ffffff;
        line-height: 1.2 !important;
    }

    @font-face {
        font-family: "unMalithi";
        src: url("Resources/un-malithi.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
    }

    @font-face {
        font-family: "unGanganee";
        src: url("Resources/un-ganganee.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
    }
</style>

<body class="flex flex-col justify-center justify-items-center items-center content-center">
    <noscript>
        <div class="h-full absolute z-10 top-0 left-0"
            style="text-align: center; padding: 20px; background-color: #f2dede; color: #a94442;">
            <p>This website requires JavaScript to function properly.</p>
            <p>Please enable JavaScript in your browser settings.</p>
        </div>
    </noscript>
    <div class="cover absolute justify-center justify-items-center items-center rounded-lg drop-shadow-md">
        <div class="flex flex-col justify-center justify-items-center items-center content-center w-full"
            style="border-right: 2px solid #ddd; border-radius: 2px">
            <img src="Resources/Daham Pasala Logo.png" class="w-28" alt="" style="filter: blur(0.6px)" /><br />
            <p class="text-center" style="font-family: 'unGanganee'; font-size: 1em; font-weight: 600">
                ශ්‍රී සුමංගල තපෝවනාරාම විහාරස්ථ<br />ශ්‍රී සුමංගල දහම් පාසල<br />පිඹුරුවැල්ලේගම<br /><br /><span
                    class="text-base font-semibold" style="font-family: 'unMalithi'; line-height: 1.5">අධ්‍යන ප්‍රගති
                    සංවර්ධන වැඩසටහන
                    <br />පෙරහුරු විභාග කටයුතු</span>
            </p>
        </div>
        <div class="flex flex-col justify-start justify-items-start items-start content-start w-full p-10">
            <p class="text-base">පරීක්ෂණ අංකය</p>
            <select id="examinations"
                class="bg-gray-50 border tracking-wide border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-1.5 mt-2"></select>
            <p class="text-base mt-4 mb-4">විභාග අංකය</p>
            <div class="w-full flex gap-5">
                <input type="text" id="exam-index"
                    class="w-2/4 border border-gray-300 text-gray-900 text-center text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block p-1.5 py-1.5" />
                <button type="button" id="session-start"
                    onclick="findIndex(document.getElementById('exam-index').value);"
                    class="w-2/4 text-white bg-[#1c64f2] hover:bg-[#1446a9]/90 min-w-[120px] font-medium rounded-lg whitespace-nowrap text-sm px-3 py-1.5 text-center inline-flex items-center justify-center transition duration-300">
                    තහවුරු කරන්න
                </button>
            </div>
            <p class="text-base mt-4">මුලකුරු සමග නම</p>
            <span id="candidate-name" class="text-sm font-normal text-left mt-2"
                style="font-family: 'unMalithi'; line-height: 1">
            </span>
            <section class="w-full flex items-center place-content-around mt-8">
                <div class="flex flex-col items-center">
                    <div role="progressbar" id="exam-result" aria-valuemin="0" aria-valuemax="100"
                        style="--examMarks:0">
                    </div>
                    <span class="text-base block mt-2">පරීක්ෂණය සදහා</span>
                </div>
                <div class="flex flex-col items-center">
                    <div role="progressbar" id="overall-result" aria-valuemin="0" aria-valuemax="100"
                        style="--overallMarks:0">
                    </div>
                    <span class="text-base block mt-2">සාමාන්‍ය ලකුණු</span>
                </div>

                <p class="text-5xl font-black block text-center"><span id="candidate-position">00</span><span
                        class="text-base block">වන
                        ස්ථානය <span class="block" id="send-stars"></span></span></p>
            </section>
        </div>
    </div>
</body>

<script>
    var jsonData = undefined;
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelector("body > div > div > img").addEventListener('contextmenu', event => event.preventDefault());
        const jsonFile = "result.json";
        fetch(jsonFile)
            .then(response => response.json())
            .then(data => {
                jsonData = data;
                parseTests();
            })
            .catch(error => console.error('Error loading JSON data:', error));
    })

    function parseTests() {
        const filteredTests = jsonData[1].filter(value => value !== null);
        filteredTests.forEach(element => {
            let option = document.createElement('option')
            option.id = jsonData[1].indexOf(element);
            option.value = element;
            option.innerText = element;

            document.getElementById("examinations").appendChild(option)
            document.getElementById("examinations").selectedIndex = document.getElementById("examinations").options.length - 1;
        });
    }

    function findIndex(enteredIndex) {
        for (var x = 2; x < 202; x++) {
            let examIndex = jsonData[x][1];
            if (examIndex != null && examIndex == enteredIndex) {
                document.getElementById("candidate-name").innerText = jsonData[x][3];
                var result = jsonData[x][document.querySelector("#examinations").selectedOptions[0].id];
                var overall = jsonData[x][58];
                var position = jsonData[x][59];
                console.log(result, overall, position);

                let progressBar = document.getElementById('exam-result');
                progressBar.style.setProperty('--examMarks', result);

                var value = 0;
                myInterval = setInterval(() => {
                    if (value > result) {
                        clearInterval(myInterval)
                    }
                    document.querySelector('div[role="progressbar"]#exam-result').style.background = `radial-gradient(closest-side, white 80%, transparent 0 100%, white 0), conic-gradient(#1c64f2 ${value}%, #def 0)`;
                    value++;
                }, 10)

                progressBar = document.getElementById('overall-result');
                progressBar.style.setProperty('--overallMarks', Math.floor(overall * 100));

                var overallValue = 0;
                overallInterval = setInterval(() => {
                    if (overallValue > overall * 100) {
                        clearInterval(overallInterval)
                    }
                    document.querySelector('div[role="progressbar"]#overall-result').style.background = `radial-gradient(closest-side, white 80%, transparent 0 100%, white 0), conic-gradient(#1c64f2 ${overallValue}%, #def 0)`;
                    overallValue++;
                }, 10)

                document.getElementById("candidate-position").innerText = position < 10 ? '0' + position : '' + position;
                if (position == 1) {
                    document.getElementById("send-stars").innerText = "⭐⭐⭐";
                } else if (position == 2) {
                    document.getElementById("send-stars").innerText = "⭐⭐";
                } else if (position == 3) {
                    document.getElementById("send-stars").innerText = "⭐";
                } else {
                    document.getElementById("send-stars").innerText = "";
                }
            }
        }
    }
</script>

</html>